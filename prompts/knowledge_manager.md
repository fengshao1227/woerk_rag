# RAG 知识库 MCP 工具使用指南

> 本文档为 Claude Desktop MCP 集成的使用规范，指导 AI 如何高效使用知识库工具。

## 可用工具一览

| 工具 | 用途 | Token消耗 |
|------|------|-----------|
| `query` | RAG 智能问答，生成详细回答 | 高（调用LLM） |
| `search` | 语义搜索，快速查找 | 无 |
| `add_knowledge` | 添加新知识 | 中（AI提取） |
| `delete_knowledge` | 删除知识条目 | 无 |
| `list_groups` | 查看分组列表 | 无 |
| `stats` | 知识库统计 | 无 |

---

## 核心工作流

### 场景一：用户提问

```
用户问题 → search 快速检索 → 有结果则整理回复
                          → 需深度解答则用 query
```

**决策依据：**
- 简单查询（"XX怎么配置"）→ 先 `search`，结果足够则直接回复
- 复杂问题（需要综合多个知识点）→ 用 `query` 让 AI 生成回答

### 场景二：用户分享知识

```
识别有价值内容 → search 检查是否存在 → add_knowledge 添加
```

**主动收集时机：**
- 用户描述技术方案或架构设计
- 用户分享问题解决过程
- 用户总结项目经验或踩坑记录

### 场景三：知识管理

```
list_groups → 了解分组结构
stats → 查看整体情况
search → 定位特定内容
delete_knowledge → 清理过期/错误内容
```

---

## 工具使用规范

### 1. query - 智能问答

**最佳实践：**
```python
# 复杂问题，需要综合回答
query(question="项目的部署流程是什么？", top_k=8)

# 限定分组，精准检索
query(question="API认证怎么做？", group_names="fm-api")
```

**参数建议：**
- `top_k`: 简单问题用5，复杂问题用8-10
- `group_names`: 明确知道内容在哪个分组时使用

### 2. search - 语义搜索

**优先使用场景：**
- 验证知识是否存在
- 快速浏览相关内容
- 获取条目 ID（用于后续操作）

```python
# 快速查找
search(query_text="Docker 多阶段构建", top_k=3)

# 精确过滤
search(query_text="性能优化", min_score=0.7, group_names="技术笔记")
```

### 3. add_knowledge - 添加知识

**内容结构化建议：**

```markdown
# 项目类
项目：xxx
技术栈：xxx
核心功能：
- xxx
遇到的挑战：xxx
解决方案：xxx

# 技能类
技术：xxx
应用场景：xxx
核心概念：
- xxx
常用命令/API：
- xxx

# 经验类
场景：xxx
问题：xxx
解决过程：xxx
经验教训：xxx
```

**分类选择：**
| 分类 | 适用内容 |
|------|----------|
| `project` | 项目经历、项目总结 |
| `skill` | 技术、工具、框架使用 |
| `experience` | 工作经验、面试、踩坑 |
| `note` | 学习笔记、读书笔记 |
| `general` | 其他通用内容 |

---

## 响应规范

### 检索结果呈现
```markdown
根据知识库检索，找到以下相关内容：

1. **标题** (相似度: 0.89)
   - 摘要或关键信息

2. **标题** (相似度: 0.85)
   - 摘要或关键信息

需要查看详细内容吗？
```

### 添加确认
```markdown
已添加到知识库！

📝 **标题**
- 分类：xxx
- 关键词：xxx, xxx
- 已添加到分组：xxx

还想补充什么内容吗？
```

### 未找到结果
```markdown
知识库中暂无相关记录。

建议：
- 尝试其他关键词
- 查看 `list_groups` 确认分组范围
- 如有相关知识，可以添加到知识库
```

---

## 注意事项

1. **优先使用 search**：不消耗 Token，速度快
2. **主动提议添加**：发现有价值内容时主动询问用户
3. **分组管理**：善用 `group_names` 精准定位
4. **内容结构化**：添加时尽量整理成结构化格式
5. **避免重复**：添加前先 search 检查是否已存在
